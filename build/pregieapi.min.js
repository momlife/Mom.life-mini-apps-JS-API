/*! PREGIE_JSAPI | 2015-11-30 */
window.PREGIEAPI||(window.PREGIEAPI=function(a){var c={},d={},g={},h=[],f={},k={forced_loading:!1},l=function(b){var e=b||[],c=function(c){for(var b=0;b<e.length;b++)c(e[b],b,e);return e};return{forEach:function(b){return c(function(){b.apply(e,arguments)})},map:function(b){var a=[];c(function(){a.push(b.apply(e,arguments))});return a},filter:function(b){var a=[];c(function(){b.apply(e,arguments)&&a.push(arguments[0])});return a}}},n=function(b,e){h.push([b,e]);m()},m=function(){var b=[];h=l(h).filter(function(e){return 0<
l(e[1]).filter(function(b){return!c[b]}).length||function(){b.push(function(b,e){return function(){b(e)}}(e[0],q(e[1])))}()});l(b).forEach(function(b){b()})},q=function(b){var e={};l(b).forEach(function(b){var a=e,d=b.split("."),g=d.pop();l(d).forEach(function(b){a=a[b]||(a[b]={})});a[g]=c[b]});return e},s=function(b){return{run:function(e){n(function(b){e.call(window[a],b)},b)},module:function(e,d){n(function(b){c[e]||(c[e]=d.call(window[a],b||void 0));m()},b);f[r(e)]=e}}},p=function(b){for(var e=
document.getElementsByTagName("script"),a=0;a<e.length;a++){var c=e[a].getAttribute("src")||"";if(-1!=c.indexOf(b))return c.substr(0,c.indexOf(b))}return""},r=function(b){for(var a in g)if(0==b.indexOf(a))return g[a];return function(){for(var a=b.length+1;0<--a;){var c=b.substring(0,a);if("undefined"!=typeof d[c])return d[c]+"/"+b.substr(c.length).split(".").join("/")+".js"}return p("/pregieapi.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()}).replace(/\/-/g,
"/")};(function(){return function(b){if(!f[b]||k.forced_loading){var a=document.createElement("script");a.setAttribute("src",b+(k.forced_loading?"?"+Math.random():""));a.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(a);f[b]=!0}else m()}})();var t=function(b){var a=function(b){var a=b.match(/^(.*)\((.*)\)$/)||[];return 3==a.length?l(a[2].split("|")).map(function(b){return a[1]+b}):[b]},c=[];l(b).forEach(function(b){l(a(b)).forEach(function(b){c.push(b)})});
return c};d["pregieapi."]=p("/pregieapi.")+"/plugins";return{load:function(){return s(t(arguments))},addPath:function(b,a){d[b]=a},addPackage:function(b,a){g[b]=a},publicateAPI:function(b,c){"undefined"==typeof window[a][b]&&(window[a][b]=c);return c},self:function(b){f[b]=!0},module:function(b,d){c[b]||(c[b]=d.call(window[a],void 0));m()},setup:function(b){for(var a in b)k[a]=b[a];return this},$debugger:{modules:c,paths:d,packages:g,hooks:h}}}("PREGIEAPI"));
PREGIEAPI.load("device","utils").module("api",function(a){var c=function(){};c.prototype.deviceInterface=function(){return this};c.prototype.getCurrentUserId=function(){return"12345"};c.prototype.showToast=function(a){alert(a)};c.prototype.getAuthToken=function(){return"JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJvcmlnX2lhdCI6MTQ0ODI4NzczMCwidXNlcm5hbWUiOiJhZG1pbiIsInVzZXJfaWQiOjEsImVtYWlsIjoiYWRtaW5AYXNkLnJ1IiwiZXhwIjoxNDQ5NDk3MzMwfQ.mPVseayRBHYQmyj1HTC5c2HTHxzS2WGv1SvhKOAeU3o"};c.prototype.uploadImage=
function(a,c){c=JSON.parse(c);var d=0,k=setInterval(function(){window[c.progress]({status:200,progress:d+=10});100==d&&(clearInterval(k),window[c.done]({status:200,url:"https://www.google.ru/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"}))},1E3)};c.prototype.makePayment=function(a){setTimeout(function(){window[a]({statusText:"OK",id:"1234567",transaction_id:"12345",someData:[]})},1E3)};var d=function(){this.deviceInterface=function(){return a.device.os.android()?window.Android:a.device.os.ios()?
window.iOS:(new c).deviceInterface()}};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};d.prototype.showToast=function(a){this.deviceInterface().showToast(a)};d.prototype.getAuthToken=function(){return this.deviceInterface().getAuthToken()};d.prototype.uploadImage=function(c,d){var f=a.utils.createGlobalCallback(d.progress),k=a.utils.createGlobalCallback(function(c){[f,k].forEach(function(c){a.utils.removeGlobalCallback(c)});
d.done&&d.done(c)});this.deviceInterface().uploadImage(c,JSON.stringify({progress:f,done:k}))};d.prototype.makePayment=function(c){var d=a.utils.createGlobalCallback(function(f){a.utils.removeGlobalCallback(d);c&&c(f)});this.deviceInterface().makePayment(d)};return this.publicateAPI("API",new d)});
PREGIEAPI.module("date",function(){return this.publicateAPI("date",{absolute:function(){var a=new Date(0);return{day:function(c){return a.setDate(c),this},month:function(c){return a.setMonth(c-1),this},year:function(c){return a.setFullYear(c),this},getTime:function(){return a.getTime()},getUTC:function(){return a.toUTCString()}}},unixtime:function(a){return~~((a||new Date).getTime()/1E3)}})});
PREGIEAPI.module("device",function(a){a=navigator.userAgent;var c=null;a.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var d=a.match(/(Android);?[\s\/]+([\d.]+)?/),g=a.match(/(iPad).*OS\s([\d_]+)/),h=a.match(/(iPod)(.*OS\s([\d_]+))?/),f=!g&&a.match(/(iPhone\sOS)\s([\d_]+)/);a={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return c},android:function(){d&&
(c=d[2]);return d},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){g&&(c=g[2].replace(/_/g,"."));return g},ipod:function(){h&&(c=h[3]?h[3].replace(/_/g,"."):null);return h},iphone:function(){f&&!h&&(c=f[2].replace(/_/g,"."));return f}}};return this.publicateAPI("device",a)});
PREGIEAPI.module("random",function(){var a=function(a,d){for(var g=d||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",h=a||16,f=[],k=0,l=g.length-1;k<h;k++)f.push(g.charAt(Math.round(Math.random()*l)));return f.join("")};return this.publicateAPI("random",{randomString:a,randomId:function(c){return"_"+a(c)},randomNumber:function(a){return parseInt(Math.random().toString().substr(2,a||10))}})});
PREGIEAPI.load("random").module("utils",function(a){var c=window;return this.publicateAPI("utils",{createGlobalCallback:function(d,g,h){g=function(a){c[a]=function(a){d.call(c,a)};return a};for(h=0;10>h++;){var f="_"+a.random.randomString();if("undefined"==typeof c[f])return g(f)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(a){try{c[a]=void 0,delete c[a]}catch(g){}},plural:function(a,c,h){var f=[2,0,1,1,1,2];return(h?a+" ":"")+c[4<a%100&&
20>a%100?2:f[5>a%10?a%10:5]]}})});
