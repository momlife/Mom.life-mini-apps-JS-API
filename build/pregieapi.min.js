/*! PREGIE_JSAPI | 2015-11-13 */
window.PREGIEAPI||(window.PREGIEAPI=function(c){var a={},d={},f={},g=[],h={},l={forced_loading:!1},k=function(b){var e=b||[],a=function(a){for(var b=0;b<e.length;b++)a(e[b],b,e);return e};return{forEach:function(b){return a(function(){b.apply(e,arguments)})},map:function(b){var c=[];a(function(){c.push(b.apply(e,arguments))});return c},filter:function(b){var c=[];a(function(){b.apply(e,arguments)&&c.push(arguments[0])});return c}}},n=function(b,e){g.push([b,e]);m()},m=function(){var b=[];g=k(g).filter(function(e){return 0<
k(e[1]).filter(function(b){return!a[b]}).length||function(){b.push(function(b,e){return function(){b(e)}}(e[0],q(e[1])))}()});k(b).forEach(function(b){b()})},q=function(b){var e={};k(b).forEach(function(b){var c=e,d=b.split("."),f=d.pop();k(d).forEach(function(b){c=c[b]||(c[b]={})});c[f]=a[b]});return e},s=function(b){return{run:function(e){n(function(b){e.call(window[c],b)},b)},module:function(e,d){n(function(b){a[e]||(a[e]=d.call(window[c],b||void 0));m()},b);h[r(e)]=e}}},p=function(b){for(var e=
document.getElementsByTagName("script"),a=0;a<e.length;a++){var c=e[a].getAttribute("src")||"";if(-1!=c.indexOf(b))return c.substr(0,c.indexOf(b))}return""},r=function(b){for(var a in f)if(0==b.indexOf(a))return f[a];return function(){for(var a=b.length+1;0<--a;){var c=b.substring(0,a);if("undefined"!=typeof d[c])return d[c]+"/"+b.substr(c.length).split(".").join("/")+".js"}return p("/pregieapi.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()}).replace(/\/-/g,
"/")};(function(){return function(b){if(!h[b]||l.forced_loading){var a=document.createElement("script");a.setAttribute("src",b+(l.forced_loading?"?"+Math.random():""));a.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(a);h[b]=!0}else m()}})();var t=function(b){var a=function(b){var a=b.match(/^(.*)\((.*)\)$/)||[];return 3==a.length?k(a[2].split("|")).map(function(b){return a[1]+b}):[b]},c=[];k(b).forEach(function(b){k(a(b)).forEach(function(b){c.push(b)})});
return c};d["pregieapi."]=p("/pregieapi.")+"/plugins";return{load:function(){return s(t(arguments))},addPath:function(b,a){d[b]=a},addPackage:function(b,a){f[b]=a},publicateAPI:function(b,a){"undefined"==typeof window[c][b]&&(window[c][b]=a);return a},self:function(b){h[b]=!0},module:function(b,d){a[b]||(a[b]=d.call(window[c],void 0));m()},setup:function(b){for(var a in b)l[a]=b[a];return this},$debugger:{modules:a,paths:d,packages:f,hooks:g}}}("PREGIEAPI"));
PREGIEAPI.load("device","utils").module("api",function(c){var a=function(){};a.prototype.deviceInterface=function(){return this};a.prototype.getCurrentUserId=function(){throw Error("MOCK INTERFACE - getCurrentUserId()");};a.prototype.showToast=function(){throw Error("MOCK INTERFACE - showToast()");};a.prototype.getAuthToken=function(){return"test-token"};a.prototype.uploadImage=function(a){a=JSON.parse(a);var c=0,d=setInterval(function(){window[a.progress]({status:200,progress:++c});10==c&&(clearInterval(d),
window[a.done]({status:200,url:"https://www.google.ru/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"}))},1E3)};var d=function(){this.deviceInterface=function(){return c.device.os.android()?window.Android:c.device.os.ios()?window.iOS:(new a).deviceInterface()}};d.prototype=Object.create(a.prototype);d.prototype.constructor=d;d.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};d.prototype.showToast=function(a){this.deviceInterface().showToast(a)};
d.prototype.getAuthToken=function(){return this.deviceInterface().getAuthToken()};d.prototype.uploadImage=function(a){this.deviceInterface().uploadImage(JSON.stringify({progress:c.utils.createGlobalCallback(a.progress),done:c.utils.createGlobalCallback(a.done)}))};return this.publicateAPI("API",new d)});
PREGIEAPI.module("date",function(){return this.publicateAPI("date",{absolute:function(){var c=new Date(0);return{day:function(a){return c.setDate(a),this},month:function(a){return c.setMonth(a-1),this},year:function(a){return c.setFullYear(a),this},getTime:function(){return c.getTime()},getUTC:function(){return c.toUTCString()}}},unixtime:function(c){return~~((c||new Date).getTime()/1E3)}})});
PREGIEAPI.module("device",function(c){c=navigator.userAgent;var a=null;c.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var d=c.match(/(Android);?[\s\/]+([\d.]+)?/),f=c.match(/(iPad).*OS\s([\d_]+)/),g=c.match(/(iPod)(.*OS\s([\d_]+))?/),h=!f&&c.match(/(iPhone\sOS)\s([\d_]+)/);c={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return a},android:function(){d&&
(a=d[2]);return d},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){f&&(a=f[2].replace(/_/g,"."));return f},ipod:function(){g&&(a=g[3]?g[3].replace(/_/g,"."):null);return g},iphone:function(){h&&!g&&(a=h[2].replace(/_/g,"."));return h}}};return this.publicateAPI("device",c)});
PREGIEAPI.module("random",function(){var c=function(a,c){for(var f=c||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",g=a||16,h=[],l=0,k=f.length-1;l<g;l++)h.push(f.charAt(Math.round(Math.random()*k)));return h.join("")};return this.publicateAPI("random",{randomString:c,randomId:function(a){return"_"+c(a)},randomNumber:function(a){return parseInt(Math.random().toString().substr(2,a||10))}})});
PREGIEAPI.load("random").module("utils",function(c){var a=window;return this.publicateAPI("utils",{createGlobalCallback:function(d,f,g){f=function(c){a[c]=function(c){d.call(a,c)};return c};for(g=0;10>g++;){var h="_"+c.random.randomString();if("undefined"==typeof a[h])return f(h)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(c){try{a[c]=void 0,delete a[c]}catch(f){}},plural:function(a,c,g){var h=[2,0,1,1,1,2];return(g?a+" ":"")+c[4<a%100&&
20>a%100?2:h[5>a%10?a%10:5]]}})});
