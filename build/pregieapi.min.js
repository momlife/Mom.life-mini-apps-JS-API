/*! PREGIE_JSAPI | 2015-11-23 */
window.PREGIEAPI||(window.PREGIEAPI=function(c){var a={},e={},g={},h=[],f={},l={forced_loading:!1},k=function(b){var d=b||[],a=function(b){for(var a=0;a<d.length;a++)b(d[a],a,d);return d};return{forEach:function(b){return a(function(){b.apply(d,arguments)})},map:function(b){var c=[];a(function(){c.push(b.apply(d,arguments))});return c},filter:function(b){var c=[];a(function(){b.apply(d,arguments)&&c.push(arguments[0])});return c}}},n=function(b,d){h.push([b,d]);m()},m=function(){var b=[];h=k(h).filter(function(d){return 0<
k(d[1]).filter(function(b){return!a[b]}).length||function(){b.push(function(b,d){return function(){b(d)}}(d[0],q(d[1])))}()});k(b).forEach(function(b){b()})},q=function(b){var d={};k(b).forEach(function(b){var c=d,e=b.split("."),g=e.pop();k(e).forEach(function(b){c=c[b]||(c[b]={})});c[g]=a[b]});return d},s=function(b){return{run:function(d){n(function(b){d.call(window[c],b)},b)},module:function(d,e){n(function(b){a[d]||(a[d]=e.call(window[c],b||void 0));m()},b);f[r(d)]=d}}},p=function(b){for(var d=
document.getElementsByTagName("script"),a=0;a<d.length;a++){var c=d[a].getAttribute("src")||"";if(-1!=c.indexOf(b))return c.substr(0,c.indexOf(b))}return""},r=function(b){for(var d in g)if(0==b.indexOf(d))return g[d];return function(){for(var d=b.length+1;0<--d;){var a=b.substring(0,d);if("undefined"!=typeof e[a])return e[a]+"/"+b.substr(a.length).split(".").join("/")+".js"}return p("/pregieapi.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()}).replace(/\/-/g,
"/")};(function(){return function(b){if(!f[b]||l.forced_loading){var d=document.createElement("script");d.setAttribute("src",b+(l.forced_loading?"?"+Math.random():""));d.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(d);f[b]=!0}else m()}})();var t=function(b){var d=function(b){var a=b.match(/^(.*)\((.*)\)$/)||[];return 3==a.length?k(a[2].split("|")).map(function(b){return a[1]+b}):[b]},a=[];k(b).forEach(function(b){k(d(b)).forEach(function(b){a.push(b)})});
return a};e["pregieapi."]=p("/pregieapi.")+"/plugins";return{load:function(){return s(t(arguments))},addPath:function(b,a){e[b]=a},addPackage:function(b,a){g[b]=a},publicateAPI:function(b,a){"undefined"==typeof window[c][b]&&(window[c][b]=a);return a},self:function(b){f[b]=!0},module:function(b,d){a[b]||(a[b]=d.call(window[c],void 0));m()},setup:function(b){for(var a in b)l[a]=b[a];return this},$debugger:{modules:a,paths:e,packages:g,hooks:h}}}("PREGIEAPI"));
PREGIEAPI.load("device","utils").module("api",function(c){var a=function(){};a.prototype.deviceInterface=function(){return this};a.prototype.getCurrentUserId=function(){throw Error("MOCK INTERFACE - getCurrentUserId()");};a.prototype.showToast=function(){throw Error("MOCK INTERFACE - showToast()");};a.prototype.getAuthToken=function(){return"test-token"};a.prototype.uploadImage=function(a){a=JSON.parse(a);var c=0,e=setInterval(function(){window[a.progress]({status:200,progress:++c});10==c&&(clearInterval(e),
window[a.done]({status:200,url:"https://www.google.ru/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"}))},1E3)};var e=function(){this.deviceInterface=function(){return c.device.os.android()?window.Android:c.device.os.ios()?window.iOS:(new a).deviceInterface()}};e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};e.prototype.showToast=function(a){this.deviceInterface().showToast(a)};
e.prototype.getAuthToken=function(){return this.deviceInterface().getAuthToken()};e.prototype.uploadImage=function(a){var e=c.utils.createGlobalCallback(a.progress),f=c.utils.createGlobalCallback(function(l){[e,f].forEach(function(a){c.utils.removeGlobalCallback(a)});a.done&&a.done(l)});this.deviceInterface().uploadImage(JSON.stringify({progress:e,done:f}))};return this.publicateAPI("API",new e)});
PREGIEAPI.module("date",function(){return this.publicateAPI("date",{absolute:function(){var c=new Date(0);return{day:function(a){return c.setDate(a),this},month:function(a){return c.setMonth(a-1),this},year:function(a){return c.setFullYear(a),this},getTime:function(){return c.getTime()},getUTC:function(){return c.toUTCString()}}},unixtime:function(c){return~~((c||new Date).getTime()/1E3)}})});
PREGIEAPI.module("device",function(c){c=navigator.userAgent;var a=null;c.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var e=c.match(/(Android);?[\s\/]+([\d.]+)?/),g=c.match(/(iPad).*OS\s([\d_]+)/),h=c.match(/(iPod)(.*OS\s([\d_]+))?/),f=!g&&c.match(/(iPhone\sOS)\s([\d_]+)/);c={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return a},android:function(){e&&
(a=e[2]);return e},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){g&&(a=g[2].replace(/_/g,"."));return g},ipod:function(){h&&(a=h[3]?h[3].replace(/_/g,"."):null);return h},iphone:function(){f&&!h&&(a=f[2].replace(/_/g,"."));return f}}};return this.publicateAPI("device",c)});
PREGIEAPI.load("random").module("utils",function(c){var a=window;return this.publicateAPI("utils",{createGlobalCallback:function(e,g,h){g=function(c){a[c]=function(c){e.call(a,c)};return c};for(h=0;10>h++;){var f="_"+c.random.randomString();if("undefined"==typeof a[f])return g(f)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(c){try{a[c]=void 0,delete a[c]}catch(g){}},plural:function(a,c,h){var f=[2,0,1,1,1,2];return(h?a+" ":"")+c[4<a%100&&
20>a%100?2:f[5>a%10?a%10:5]]}})});
