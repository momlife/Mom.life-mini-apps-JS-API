/*! PREGIE_JSAPI | 2015-11-25 */
window.PREGIEAPI||(window.PREGIEAPI=function(c){var a={},e={},d={},h=[],g={},l={forced_loading:!1},k=function(b){var f=b||[],a=function(a){for(var b=0;b<f.length;b++)a(f[b],b,f);return f};return{forEach:function(b){return a(function(){b.apply(f,arguments)})},map:function(b){var d=[];a(function(){d.push(b.apply(f,arguments))});return d},filter:function(b){var d=[];a(function(){b.apply(f,arguments)&&d.push(arguments[0])});return d}}},n=function(b,f){h.push([b,f]);m()},m=function(){var b=[];h=k(h).filter(function(f){return 0<
k(f[1]).filter(function(b){return!a[b]}).length||function(){b.push(function(b,f){return function(){b(f)}}(f[0],q(f[1])))}()});k(b).forEach(function(b){b()})},q=function(b){var f={};k(b).forEach(function(b){var d=f,c=b.split("."),e=c.pop();k(c).forEach(function(b){d=d[b]||(d[b]={})});d[e]=a[b]});return f},s=function(b){return{run:function(f){n(function(b){f.call(window[c],b)},b)},module:function(f,d){n(function(b){a[f]||(a[f]=d.call(window[c],b||void 0));m()},b);g[r(f)]=f}}},p=function(b){for(var d=
document.getElementsByTagName("script"),a=0;a<d.length;a++){var c=d[a].getAttribute("src")||"";if(-1!=c.indexOf(b))return c.substr(0,c.indexOf(b))}return""},r=function(b){for(var a in d)if(0==b.indexOf(a))return d[a];return function(){for(var a=b.length+1;0<--a;){var d=b.substring(0,a);if("undefined"!=typeof e[d])return e[d]+"/"+b.substr(d.length).split(".").join("/")+".js"}return p("/pregieapi.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()}).replace(/\/-/g,
"/")};(function(){return function(b){if(!g[b]||l.forced_loading){var a=document.createElement("script");a.setAttribute("src",b+(l.forced_loading?"?"+Math.random():""));a.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(a);g[b]=!0}else m()}})();var t=function(b){var a=function(b){var a=b.match(/^(.*)\((.*)\)$/)||[];return 3==a.length?k(a[2].split("|")).map(function(b){return a[1]+b}):[b]},d=[];k(b).forEach(function(b){k(a(b)).forEach(function(b){d.push(b)})});
return d};e["pregieapi."]=p("/pregieapi.")+"/plugins";return{load:function(){return s(t(arguments))},addPath:function(b,a){e[b]=a},addPackage:function(b,a){d[b]=a},publicateAPI:function(b,a){"undefined"==typeof window[c][b]&&(window[c][b]=a);return a},self:function(b){g[b]=!0},module:function(b,d){a[b]||(a[b]=d.call(window[c],void 0));m()},setup:function(b){for(var a in b)l[a]=b[a];return this},$debugger:{modules:a,paths:e,packages:d,hooks:h}}}("PREGIEAPI"));
PREGIEAPI.load("device","utils").module("api",function(c){var a=function(){};a.prototype.deviceInterface=function(){return this};a.prototype.getCurrentUserId=function(){return"12345"};a.prototype.showToast=function(a){alert(a)};a.prototype.getAuthToken=function(){return"JWT eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJvcmlnX2lhdCI6MTQ0ODI4NzczMCwidXNlcm5hbWUiOiJhZG1pbiIsInVzZXJfaWQiOjEsImVtYWlsIjoiYWRtaW5AYXNkLnJ1IiwiZXhwIjoxNDQ5NDk3MzMwfQ.mPVseayRBHYQmyj1HTC5c2HTHxzS2WGv1SvhKOAeU3o"};a.prototype.uploadImage=
function(a){a=JSON.parse(a);var c=0,e=setInterval(function(){window[a.progress]({status:200,progress:c+=10});100==c&&(clearInterval(e),window[a.done]({status:200,url:"https://www.google.ru/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"}))},1E3)};a.prototype.makePayment=function(a){setTimeout(function(){window[a]({status:"OK",id:"1234567",someData:[]})},1E3)};var e=function(){this.deviceInterface=function(){return c.device.os.android()?window.Android:c.device.os.ios()?window.iOS:(new a).deviceInterface()}};
e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};e.prototype.showToast=function(a){this.deviceInterface().showToast(a)};e.prototype.getAuthToken=function(){return this.deviceInterface().getAuthToken()};e.prototype.uploadImage=function(a){var e=c.utils.createGlobalCallback(a.progress),g=c.utils.createGlobalCallback(function(l){[e,g].forEach(function(a){c.utils.removeGlobalCallback(a)});a.done&&
a.done(l)});this.deviceInterface().uploadImage(JSON.stringify({progress:e,done:g}))};e.prototype.makePayment=function(a){var e=c.utils.createGlobalCallback(function(g){c.utils.removeGlobalCallback(e);a&&a(g)});this.deviceInterface().makePayment(e)};return this.publicateAPI("API",new e)});
PREGIEAPI.module("date",function(){return this.publicateAPI("date",{absolute:function(){var c=new Date(0);return{day:function(a){return c.setDate(a),this},month:function(a){return c.setMonth(a-1),this},year:function(a){return c.setFullYear(a),this},getTime:function(){return c.getTime()},getUTC:function(){return c.toUTCString()}}},unixtime:function(c){return~~((c||new Date).getTime()/1E3)}})});
PREGIEAPI.module("device",function(c){c=navigator.userAgent;var a=null;c.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var e=c.match(/(Android);?[\s\/]+([\d.]+)?/),d=c.match(/(iPad).*OS\s([\d_]+)/),h=c.match(/(iPod)(.*OS\s([\d_]+))?/),g=!d&&c.match(/(iPhone\sOS)\s([\d_]+)/);c={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return a},android:function(){e&&
(a=e[2]);return e},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){d&&(a=d[2].replace(/_/g,"."));return d},ipod:function(){h&&(a=h[3]?h[3].replace(/_/g,"."):null);return h},iphone:function(){g&&!h&&(a=g[2].replace(/_/g,"."));return g}}};return this.publicateAPI("device",c)});
PREGIEAPI.module("random",function(){var c=function(a,c){for(var d=c||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",h=a||16,g=[],l=0,k=d.length-1;l<h;l++)g.push(d.charAt(Math.round(Math.random()*k)));return g.join("")};return this.publicateAPI("random",{randomString:c,randomId:function(a){return"_"+c(a)},randomNumber:function(a){return parseInt(Math.random().toString().substr(2,a||10))}})});
PREGIEAPI.load("random").module("utils",function(c){var a=window;return this.publicateAPI("utils",{createGlobalCallback:function(e,d,h){d=function(c){a[c]=function(c){e.call(a,c)};return c};for(h=0;10>h++;){var g="_"+c.random.randomString();if("undefined"==typeof a[g])return d(g)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(c){try{a[c]=void 0,delete a[c]}catch(d){}},plural:function(a,c,h){var g=[2,0,1,1,1,2];return(h?a+" ":"")+c[4<a%100&&
20>a%100?2:g[5>a%10?a%10:5]]}})});
