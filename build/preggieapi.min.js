/*! PREGGIE_EXTENSIONS_JS_API | 2016-04-14 */
(Modules=window.Modules||{}).name=Modules.name||"Modules";
Modules&&Modules.load||(Modules=window[Modules.name]=function(c){var b={},a={},d={},g=[],e={},f={},h={forced_loading:!1},m=function(){window.console&&console.warn.apply(console,arguments)},k=function(b){var a=b||[],d=function(b){for(var d=0;d<a.length;d++)b(a[d],d,a);return a};return{forEach:function(b){return d(function(){b.apply(a,arguments)})},map:function(b){var l=[];d(function(){l.push(b.apply(a,arguments))});return l},filter:function(b){var l=[];d(function(){b.apply(a,arguments)&&l.push(arguments[0])});
return l}}},p=function(b,a){g.push([b,a]);n()},n=function(){var a=[];g=k(g).filter(function(d){return 0<k(d[1]).filter(function(a){return!b[a]}).length||function(){a.push(function(a,b){return function(){a(b)}}(d[0],r(d[1])))}()});k(a).forEach(function(a){a()})},r=function(a){var d={};k(a).forEach(function(a){var c=d,g=a.split("."),l=g.pop();k(g).forEach(function(a){c=c[a]||(c[a]={})});c[l]=b[a]});return d},s=function(a){return{run:function(b){p(function(a){b.call(window[c],a)},a)},module:function(d,
g){f[d]||(f[d]=a);k(a).forEach(function(a){f[a]&&-1!=f[a].indexOf(d)&&m('Cross modular relation between modules "%s" and "%s". Modules not loaded.',d,a)});p(function(a){b[d]||(b[d]=g.call(window[c],a||void 0));n()},a)}}},q=function(a){for(var b=document.getElementsByTagName("script"),d=0;d<b.length;d++){var c=b[d].getAttribute("src")||"";if(-1!=c.indexOf(a))return c.substr(0,c.indexOf(a))}return""},t=function(b){for(var c in d)if(0==b.indexOf(c))return d[c];return function(){for(var d=b.length+1;0<
--d;){var c=b.substring(0,d);if("undefined"!=typeof a[c])return a[c]+"/"+b.substr(c.length).split(".").join("/")+".js"}return q("/modules.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/\/-/g,"/")},u=function(){return function(a){if(!e[a]||h.forced_loading){var b=document.createElement("script");b.setAttribute("src",a+(h.forced_loading?"?"+Math.random():""));b.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(b);
e[a]=!0}else n()}}(),v=function(a){var d=function(a){var b=a.match(/^(.*)\((.*)\)$/)||[];return 3==b.length?k(b[2].split("|")).map(function(a){return b[1]+a}):[a]},c=[];k(a).forEach(function(a){k(d(a)).forEach(function(a){c.push(a);b[a]||setTimeout(function(){b[a]||u(t(a))},50)})});return c};a["modules."]=q("/modules.")+"/plugins";return{load:function(){return s(v(Array.prototype.slice.call(arguments)))},addPath:function(b,d){a[b]=d},addPackage:function(a,b){d[a]=b},publicateAPI:function(a,b){"undefined"==
typeof window[c][a]&&(window[c][a]=b);return b},self:function(a){e[a]=!0},module:function(a,d){b[a]||(b[a]=d.call(window[c],void 0));n()},setup:function(a){for(var b in a)h[b]=a[b];return this},name:window[c].name,$debugger:{modules:b,paths:a,packages:d,hooks:g,dependencies:f}}}("Modules"));
Modules.load("device","utils","random").module("api",function(c){window.PREGGIEAPI=Modules;var b=function(){};b.prototype.deviceInterface=function(){return this};b.prototype.getCurrentUserId=function(){return"123456789"};b.prototype.showToast=function(a){alert(a)};b.prototype.getAuthToken=function(a){a=JSON.parse(a);window[a.success]({token:"JWT some token..."})};b.prototype.upload=function(a,b){b=JSON.parse(b);var c=0;Math.random();var f=setInterval(function(){window[b.progress]({progress:c+=10});
100==c&&(clearInterval(f),window[b.success]({name:"2015:12:23:0820a982-8837-4f26-b8e0-cea32c121c6c.jpg"}))},500);window[b.preview]("iVBORw0KGgoAAAANSUhEUgAAADEAAAA0CAIAAACsM0f4AAADPklEQVR42u2X30tTYRjHj+gMttqPznYwu9CbKUxCyh9sI6YLERkuJdRQKoKg/gDvu+jeP6Cgq0ohJLULiVkXDpRASwbbErdgY8yBUslsQzfDHjzx8uz17OxsHLcZ52EX73nPe57z2fN+n+d9Ts3x8TFTZVajMClMCpPCpDCdb6ZU6ncsFhFZYTSaWJYTvJXNZnZ3E3t7P/hLvZ41ma6oVPX5XMF6shhMo7moVl8SYNrc9E9NPRVhcrvH3O671GQ6vR8IbESjIWq+p8cFWPlcra158SMWy3WL5YY8TNvb0aWl9xqN+vRiESb4G4uLb/GMbEzJ5M+5uTeCQOJMVJCKYDIYTFqtDq9wOgfsdie5nJ9/fXR0SC61WkNLyzVQBoxBmhzXICgRUNLCwitqUirT5OSz1ta2fDGDXVtd/UguOzsdzc1mRoIFg1+DwY0zYfJ6P+zsxMU9CgZpevo5v92pVJrsuzxMs7Mv+QG4nph4IpL2+YJkNreFQgHZmKAULS8v8mOOu+pwDBQbJHhKp9PLyQS+fL7P2B3IKxz+dnCQNhiMICzBjItEQuvrXn5st/f5/V+SyV/FMdlsvUZjTtWGpOPrON4C8B6PR6nchn1pb7dSL5iZeaFS1Z4E7M/4+GOP513RTKeNRA4LHMsi9w/0NTY2CQaJT1KZmbC7fFZXd2F4+F6+IFFO5GcCwdpst7LZQ49nAVdRl2uML5u4mMGeQmhLZBLRE8Uk+G68fWQ9LhylMInkHXYHR0p//x1yi9Qt8iZcOPC7K8mEEwJEplb/q92JRJzUcRAZyxphgF0Vx4QP9oJMUhKC2MjIoxKZcH2i8qtiTFgiYEND93nZUs0a30KViYnqgUh6w4GD6ydhFTR56hPuM6leEZgymQyeaWoyd3U5RLzJz3S6p8YGdWh09KFgn3mGTEzuEUYZddiVj4k5EfvKyieqK7dae7Xay0whk8RU8ncw7CN8FDAnn5oSG06JVpXf5grT/8EUi30Ph3M62o6Om1Ky6QyZtrZ88MO3bbZ+lm2oPFNtbX13dy8/A0GSN89LZNJo9E7n7TJznEMmOEo5rpGfqQhcAY0PDj6oCias8fInHXNu9KQwCdhfKV/ntwyR1acAAAAASUVORK5CYII=");
return f};b.prototype.cancelUpload=function(a){clearInterval(a)};b.prototype.makePayment=function(a,b){b=JSON.parse(b);setTimeout(function(){window[b.success]({transaction_id:c.random.randomNumber()})},1E3)};b.prototype.getAppId=function(){return"123456789"};b.prototype.canExit=function(a){};var a=function(){this.deviceInterface=function(){return c.device.os.android()?window.Android:c.device.os.ios()?window.iOS:(new b).deviceInterface()};Object.defineProperties(this,{_token:{writable:!0,value:null},
_canExit:{writable:!0,value:!0}})};a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};a.prototype.showToast=function(a){this.deviceInterface().showToast(a)};a.prototype.getAuthToken=function(a){if(!a)return this._token;var b=this,e=c.utils.createGlobalCallback(function(h){[e,f].forEach(function(a){c.utils.removeGlobalCallback(a)});a.success&&a.success(b._token=h.token,h)}),f=c.utils.createGlobalCallback(function(b){[e,
f].forEach(function(a){c.utils.removeGlobalCallback(a)});a.error&&a.error(b)});return this.deviceInterface().getAuthToken(JSON.stringify({success:e,error:f}))};a.prototype.upload=function(a,b){var e=c.utils.createGlobalCallback(b.preview),f=c.utils.createGlobalCallback(b.progress),h=c.utils.createGlobalCallback(function(a){[e,f,h,m].forEach(function(a){c.utils.removeGlobalCallback(a)});b.success&&b.success(a)}),m=c.utils.createGlobalCallback(function(a){[e,f,h,m].forEach(function(a){c.utils.removeGlobalCallback(a)});
b.error&&b.error(a)});return this.deviceInterface().upload(a,JSON.stringify({preview:e,progress:f,success:h,error:m}))};a.prototype.cancelUpload=function(a){this.deviceInterface().cancelUpload(a)};a.prototype.makePayment=function(a,b){var e=c.utils.createGlobalCallback(function(a){[e,f].forEach(function(a){c.utils.removeGlobalCallback(a)});b.success&&b.success(a)}),f=c.utils.createGlobalCallback(function(a){[e,f].forEach(function(a){c.utils.removeGlobalCallback(a)});b.error&&b.error(a)});this.deviceInterface().makePayment(a,
JSON.stringify({success:e,error:f}))};a.prototype.getAppId=function(){return this.deviceInterface().getAppId()};a.prototype.canExit=function(a){0<arguments.length&&(this._canExit=!!a);this.deviceInterface().canExit(this._canExit);return this._canExit};return this.publicateAPI("API",new a)});
Modules.module("date",function(){var c={absolute:function(){var b=new Date(0);return{day:function(a){return b.setDate(a),this},month:function(a){return b.setMonth(a-1),this},year:function(a){return b.setFullYear(a),this},getTime:function(){return b.getTime()},getUTC:function(){return b.toUTCString()}}},unixtime:function(b){return~~((b||new Date).getTime()/1E3)},toLocaleString:function(b,a,d){return(new Date(1E3*(b||c.unixtime()))).toLocaleString(a||"ru",d)},H_M:function(b){var a=new Date(1E3*b);b=
10>a.getHours()?"0"+a.getHours():a.getHours();a=10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes();return b+":"+a}};return this.publicateAPI("date",c)});
Modules.module("device",function(){var c=navigator.userAgent,b=null;c.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var a=c.match(/(Android);?[\s\/]+([\d.]+)?/),d=c.match(/(iPad).*OS\s([\d_]+)/),g=c.match(/(iPod)(.*OS\s([\d_]+))?/),e=!d&&c.match(/(iPhone\sOS)\s([\d_]+)/),c={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return b},android:function(){a&&
(b=a[2]);return a},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){d&&(b=d[2].replace(/_/g,"."));return d},ipod:function(){g&&(b=g[3]?g[3].replace(/_/g,"."):null);return g},iphone:function(){e&&!g&&(b=e[2].replace(/_/g,"."));return e}}};return this.publicateAPI("device",c)});
Modules.module("random",function(){var c=function(b,a){for(var c=a||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",g=b||16,e=[],f=0,h=c.length-1;f<g;f++)e.push(c.charAt(Math.round(Math.random()*h)));return e.join("")};return this.publicateAPI("random",{randomString:c,randomId:function(b){return"_"+c(b)},randomNumber:function(b){return parseInt(Math.random().toString().substr(2,b||10))}})});
Modules.load("random").module("utils",function(c){var b=window;return this.publicateAPI("utils",{createGlobalCallback:function(a){for(var d=function(c){b[c]=function(c){a.call(b,c)};return c},g=0;10>g++;){var e="_"+c.random.randomString();if("undefined"==typeof b[e])return d(e)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(a){try{b[a]=void 0,delete b[a]}catch(c){}},plural:function(a,b,c){var e=[2,0,1,1,1,2];return(c?a+" ":"")+b[4<a%100&&
20>a%100?2:e[5>a%10?a%10:5]]}})});
