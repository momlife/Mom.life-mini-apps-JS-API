/*! 
 * momlife-extensions-js-api v1.5.2
 * 
 * Author: Alexander Usolcev <alexander.usolcev@gmail.com>
 * Date: 2017-01-04 14:50:53
 * 
 */
!function(a){"use strict";function b(a){if("string"!=typeof a&&(a=String(a)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function c(a){return"string"!=typeof a&&(a=String(a)),a}function d(a){var b={next:function(){var b=a.shift();return{done:void 0===b,value:b}}};return r.iterable&&(b[Symbol.iterator]=function(){return b}),b}function e(a){this.map={},a instanceof e?a.forEach(function(a,b){this.append(b,a)},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function f(a){return a.bodyUsed?Promise.reject(new TypeError("Already read")):void(a.bodyUsed=!0)}function g(a){return new Promise(function(b,c){a.onload=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function h(a){var b=new FileReader,c=g(b);return b.readAsArrayBuffer(a),c}function i(a){var b=new FileReader,c=g(b);return b.readAsText(a),c}function j(a){for(var b=new Uint8Array(a),c=new Array(b.length),d=0;d<b.length;d++)c[d]=String.fromCharCode(b[d]);return c.join("")}function k(a){if(a.slice)return a.slice(0);var b=new Uint8Array(a.byteLength);return b.set(new Uint8Array(a)),b.buffer}function l(){return this.bodyUsed=!1,this._initBody=function(a){if(this._bodyInit=a,a)if("string"==typeof a)this._bodyText=a;else if(r.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a;else if(r.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(r.searchParams&&URLSearchParams.prototype.isPrototypeOf(a))this._bodyText=a.toString();else if(r.arrayBuffer&&r.blob&&t(a))this._bodyArrayBuffer=k(a.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!r.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(a)&&!u(a))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=k(a)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof a?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(a)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var a=f(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var a=f(this);if(a)return a;if(this._bodyBlob)return i(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(j(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(o)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(a){var b=a.toUpperCase();return v.indexOf(b)>-1?b:a}function n(a,b){b=b||{};var c=b.body;if("string"==typeof a)this.url=a;else{if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,b.headers||(this.headers=new e(a.headers)),this.method=a.method,this.mode=a.mode,c||null==a._bodyInit||(c=a._bodyInit,a.bodyUsed=!0)}if(this.credentials=b.credentials||this.credentials||"omit",!b.headers&&this.headers||(this.headers=new e(b.headers)),this.method=m(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&c)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(c)}function o(a){var b=new FormData;return a.trim().split("&").forEach(function(a){if(a){var c=a.split("="),d=c.shift().replace(/\+/g," "),e=c.join("=").replace(/\+/g," ");b.append(decodeURIComponent(d),decodeURIComponent(e))}}),b}function p(a){var b=new e;return a.split("\r\n").forEach(function(a){var c=a.split(":"),d=c.shift().trim();if(d){var e=c.join(":").trim();b.append(d,e)}}),b}function q(a,b){b||(b={}),this.type="default",this.status="status"in b?b.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new e(b.headers),this.url=b.url||"",this._initBody(a)}if(!a.fetch){var r={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(a){return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};if(r.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],t=function(a){return a&&DataView.prototype.isPrototypeOf(a)},u=ArrayBuffer.isView||function(a){return a&&s.indexOf(Object.prototype.toString.call(a))>-1};e.prototype.append=function(a,d){a=b(a),d=c(d);var e=this.map[a];this.map[a]=e?e+","+d:d},e.prototype.delete=function(a){delete this.map[b(a)]},e.prototype.get=function(a){return a=b(a),this.has(a)?this.map[a]:null},e.prototype.has=function(a){return this.map.hasOwnProperty(b(a))},e.prototype.set=function(a,d){this.map[b(a)]=c(d)},e.prototype.forEach=function(a,b){for(var c in this.map)this.map.hasOwnProperty(c)&&a.call(b,this.map[c],c,this)},e.prototype.keys=function(){var a=[];return this.forEach(function(b,c){a.push(c)}),d(a)},e.prototype.values=function(){var a=[];return this.forEach(function(b){a.push(b)}),d(a)},e.prototype.entries=function(){var a=[];return this.forEach(function(b,c){a.push([c,b])}),d(a)},r.iterable&&(e.prototype[Symbol.iterator]=e.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];n.prototype.clone=function(){return new n(this,{body:this._bodyInit})},l.call(n.prototype),l.call(q.prototype),q.prototype.clone=function(){return new q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new e(this.headers),url:this.url})},q.error=function(){var a=new q(null,{status:0,statusText:""});return a.type="error",a};var w=[301,302,303,307,308];q.redirect=function(a,b){if(w.indexOf(b)===-1)throw new RangeError("Invalid status code");return new q(null,{status:b,headers:{location:a}})},a.Headers=e,a.Request=n,a.Response=q,a.fetch=function(a,b){return new Promise(function(c,d){var e=new n(a,b),f=new XMLHttpRequest;f.onload=function(){var a={status:f.status,statusText:f.statusText,headers:p(f.getAllResponseHeaders()||"")};a.url="responseURL"in f?f.responseURL:a.headers.get("X-Request-URL");var b="response"in f?f.response:f.responseText;c(new q(b,a))},f.onerror=function(){d(new TypeError("Network request failed"))},f.ontimeout=function(){d(new TypeError("Network request failed"))},f.open(e.method,e.url,!0),"include"===e.credentials&&(f.withCredentials=!0),"responseType"in f&&r.blob&&(f.responseType="blob"),e.headers.forEach(function(a,b){f.setRequestHeader(b,a)}),f.send("undefined"==typeof e._bodyInit?null:e._bodyInit)})},a.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),(Modules=window.Modules||{}).name=Modules.name||"Modules",Modules&&Modules.load||(Modules=window[Modules.name]=function(a){var b={},c={},d={},e=[],f={},g={},h={forced_loading:!1},i=function(){window.console&&console.warn.apply(console,arguments)},j=function(a){var b=a||[],c=function(a){for(var c=0;c<b.length;c++)a(b[c],c,b);return b};return{forEach:function(a){return c(function(){a.apply(b,arguments)})},map:function(a){var d=[];return c(function(){d.push(a.apply(b,arguments))}),d},filter:function(a){var d=[];return c(function(){a.apply(b,arguments)&&d.push(arguments[0])}),d}}},k=function(a,b){e.push([a,b]),m()},l=function(c,d,e){b[c]||(b[c]=d.call(window[a],e||void 0)),m()},m=function(){var a=[];e=j(e).filter(function(c){return j(c[1]).filter(function(a){return!b[a]}).length>0||function(){a.push(function(a,b){return function(){a(b)}}(c[0],n(c[1])))}()}),j(a).forEach(function(a){a()})},n=function(a){var c={};return j(a).forEach(function(a){var d=c,e=a.split("."),f=e.pop();j(e).forEach(function(a){d=d[a]||(d[a]={})}),d[f]=b[a]}),c},o=function(b){return{run:function(c){k(function(b){c.call(window[a],b)},b)},module:function(a,c){g[a]||(g[a]=b),j(b).forEach(function(b){g[b]&&g[b].indexOf(a)!=-1&&i('Cross modular relation between modules "%s" and "%s". Modules not loaded.',a,b)}),k(function(b){l(a,c,b)},b)}}},p=function(a){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++){var d=b[c].getAttribute("src")||"";if(d.indexOf(a)!=-1)return d.substr(0,d.indexOf(a))}return""},q=function(a){for(var b in d)if(0==a.indexOf(b))return d[b];return function(){for(var b=a.length+1;--b>0;){var d=a.substring(0,b);if("undefined"!=typeof c[d])return c[d]+"/"+a.substr(d.length).split(".").join("/")+".js"}return p("/modules.")+"/plugins/"+a.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/\/-/g,"/")},r=function(){return function(a){if(!f[a]||h.forced_loading){var b=document.createElement("script");b.setAttribute("src",a+(h.forced_loading?"?"+Math.random():"")),b.setAttribute("type","text/javascript"),document.getElementsByTagName("head")[0].appendChild(b),f[a]=!0}else m()}}(),s=function(a){var c=function(a){var b=a.match(/^(.*)\((.*)\)$/)||[];return 3==b.length?j(b[2].split("|")).map(function(a){return b[1]+a}):[a]},d=[];return j(a).forEach(function(a){j(c(a)).forEach(function(a){d.push(a),b[a]||setTimeout(function(){b[a]||r(q(a))},50)})}),d};c["modules."]=p("/modules.")+"/plugins";var t=function(a,b){for(var c in b)a[c]=b[c];return a};return{load:function(){return o(s(Array.prototype.slice.call(arguments)))},addPath:function(a,b){c[a]=b},addPackage:function(a,b){d[a]=b},publicateAPI:function(b,c){return"undefined"==typeof window[a][b]&&(window[a][b]=c),c},self:function(a){f[a]=!0},module:function(a,b){l(a,b)},setup:function(a){return t(h,a),this},name:window[a].name,$debugger:{modules:b,paths:c,packages:d,hooks:e,dependencies:g}}}("Modules")),Modules.load("device","utils","random").module("api",function(a){function b(a){console.warn(a)}window.PREGGIEAPI=Modules;var c="https://js-api.ext.mom.life",d=function(){};d.prototype.deviceInterface=function(){return this},d.prototype.getCurrentUserId=function(){return"123456789"},d.prototype.showToast=function(a){alert(a)},d.prototype.getAuthToken=function(a){a=JSON.parse(a),fetch(c+"/auth/preggie/bind",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({preggie_id:"123456789",login:"some-login"})}).then(function(a){return a.json()}).then(function(b){window[a.success]({token:b["auth-token"]})}).catch(function(b){window[a.error]({status:101,statusText:"getAuthToken error",errorMessage:b.message})})},d.prototype.upload=function(a,b){b=JSON.parse(b);var c=0,d=(Math.random()>=.5?101:100,setInterval(function(){window[b.progress]({progress:c+=10}),100==c&&(clearInterval(d),window[b.success]({name:"2015:12:23:0820a982-8837-4f26-b8e0-cea32c121c6c.jpg"}))},500));return window[b.preview]("iVBORw0KGgoAAAANSUhEUgAAADEAAAA0CAIAAACsM0f4AAADPklEQVR42u2X30tTYRjHj+gMttqPznYwu9CbKUxCyh9sI6YLERkuJdRQKoKg/gDvu+jeP6Cgq0ohJLULiVkXDpRASwbbErdgY8yBUslsQzfDHjzx8uz17OxsHLcZ52EX73nPe57z2fN+n+d9Ts3x8TFTZVajMClMCpPCpDCdb6ZU6ncsFhFZYTSaWJYTvJXNZnZ3E3t7P/hLvZ41ma6oVPX5XMF6shhMo7moVl8SYNrc9E9NPRVhcrvH3O671GQ6vR8IbESjIWq+p8cFWPlcra158SMWy3WL5YY8TNvb0aWl9xqN+vRiESb4G4uLb/GMbEzJ5M+5uTeCQOJMVJCKYDIYTFqtDq9wOgfsdie5nJ9/fXR0SC61WkNLyzVQBoxBmhzXICgRUNLCwitqUirT5OSz1ta2fDGDXVtd/UguOzsdzc1mRoIFg1+DwY0zYfJ6P+zsxMU9CgZpevo5v92pVJrsuzxMs7Mv+QG4nph4IpL2+YJkNreFQgHZmKAULS8v8mOOu+pwDBQbJHhKp9PLyQS+fL7P2B3IKxz+dnCQNhiMICzBjItEQuvrXn5st/f5/V+SyV/FMdlsvUZjTtWGpOPrON4C8B6PR6nchn1pb7dSL5iZeaFS1Z4E7M/4+GOP513RTKeNRA4LHMsi9w/0NTY2CQaJT1KZmbC7fFZXd2F4+F6+IFFO5GcCwdpst7LZQ49nAVdRl2uML5u4mMGeQmhLZBLRE8Uk+G68fWQ9LhylMInkHXYHR0p//x1yi9Qt8iZcOPC7K8mEEwJEplb/q92JRJzUcRAZyxphgF0Vx4QP9oJMUhKC2MjIoxKZcH2i8qtiTFgiYEND93nZUs0a30KViYnqgUh6w4GD6ydhFTR56hPuM6leEZgymQyeaWoyd3U5RLzJz3S6p8YGdWh09KFgn3mGTEzuEUYZddiVj4k5EfvKyieqK7dae7Xay0whk8RU8ncw7CN8FDAnn5oSG06JVpXf5grT/8EUi30Ph3M62o6Om1Ky6QyZtrZ88MO3bbZ+lm2oPFNtbX13dy8/A0GSN89LZNJo9E7n7TJznEMmOEo5rpGfqQhcAY0PDj6oCias8fInHXNu9KQwCdhfKV/ntwyR1acAAAAASUVORK5CYII="),d},d.prototype.cancelUpload=function(a){clearInterval(a)},d.prototype.makePayment=function(b,c){c=JSON.parse(c),setTimeout(function(){window[c.success]({transaction_id:a.random.randomNumber()})},1e3)},d.prototype.getAppId=function(){return"123456789"},d.prototype.canExit=function(a){},d.prototype.setTitle=function(a){document.title=a},d.prototype.isDevice=function(){return!(!window.Android&&!window.iOS)},d.prototype.version="1.5.2",d.prototype.API_HOST=c;var e=function(){this.deviceInterface=function(){return a.device.os.android()?window.Android:a.device.os.ios()?window.iOS:(new d).deviceInterface()},Object.defineProperties(this,{_token:{writable:!0,value:null},canExitState:{writable:!0,value:!0}})};return e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()},e.prototype.showToast=function(a){this.deviceInterface().showToast(a)},e.prototype.getAuthToken=function(b){function c(c){[f,g].forEach(function(b){a.utils.removeGlobalCallback(b)}),b.success&&b.success(e._token=c.token,c)}function d(c){[f,g].forEach(function(b){a.utils.removeGlobalCallback(b)}),b.error&&b.error(c)}if(!b)return this._token;var e=this,f=a.utils.createGlobalCallback(c),g=a.utils.createGlobalCallback(d);return this.deviceInterface().getAuthToken(JSON.stringify({success:f,error:g}))},e.prototype.upload=function(b,c){function d(b){[f,g,h,i].forEach(function(b){a.utils.removeGlobalCallback(b)}),c.success&&c.success(b)}function e(b){[f,g,h,i].forEach(function(b){a.utils.removeGlobalCallback(b)}),c.error&&c.error(b)}var f=a.utils.createGlobalCallback(c.preview),g=a.utils.createGlobalCallback(c.progress),h=a.utils.createGlobalCallback(d),i=a.utils.createGlobalCallback(e);return this.deviceInterface().upload(b,JSON.stringify({preview:f,progress:g,success:h,error:i}))},e.prototype.cancelUpload=function(a){this.deviceInterface().cancelUpload(a)},e.prototype.makePayment=function(b,c){function d(b){[f,g].forEach(function(b){a.utils.removeGlobalCallback(b)}),c.success&&c.success(b)}function e(b){[f,g].forEach(function(b){a.utils.removeGlobalCallback(b)}),c.error&&c.error(b)}var f=a.utils.createGlobalCallback(d),g=a.utils.createGlobalCallback(e);this.deviceInterface().makePayment(b,JSON.stringify({success:f,error:g}))},e.prototype.getAppId=function(){return this.deviceInterface().getAppId()},e.prototype.canExit=function(a){return arguments.length>0&&(this.canExitState=!!a),this.deviceInterface().canExit(this.canExitState),this.canExitState},e.prototype.setTitle=function(a){try{a&&this.deviceInterface().setTitle(a)}catch(a){b(a)}return a},this.publicateAPI("API",new e)}),Modules.module("date",function(){var a={};return a.absolute=function(){var a=new Date(0);return{day:function(b){return a.setDate(b),this},month:function(b){return a.setMonth(b-1),this},year:function(b){return a.setFullYear(b),this},getTime:function(){return a.getTime()},getUTC:function(){return a.toUTCString()}}},a.unixtime=function(a){return~~((a||new Date).getTime()/1e3)},a.toLocaleString=function(b,c,d){var e=new Date(1e3*(b||a.unixtime()));return e.toLocaleString(c||"ru",d)},a.H_M=function(a){var b=new Date(1e3*a),c=b.getHours()<10?"0"+b.getHours():b.getHours(),d=b.getMinutes()<10?"0"+b.getMinutes():b.getMinutes();return c+":"+d},this.publicateAPI("date",a)}),Modules.module("device",function(){var a=navigator.userAgent,b=null,c=(a.match(/Web[kK]it[\/]{0,1}([\d.]+)/),a.match(/(Android);?[\s\/]+([\d.]+)?/)),d=a.match(/(iPad).*OS\s([\d_]+)/),e=a.match(/(iPod)(.*OS\s([\d_]+))?/),f=!d&&a.match(/(iPhone\sOS)\s([\d_]+)/),g={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return b},android:function(){return c&&(b=c[2]),c},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){return d&&(b=d[2].replace(/_/g,".")),d},ipod:function(){return e&&(b=e[3]?e[3].replace(/_/g,"."):null),e},iphone:function(){return f&&!e&&(b=f[2].replace(/_/g,".")),f}}};return this.publicateAPI("device",g)}),Modules.module("random",function(){var a=function(a,b){for(var c=b||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",d=a||16,e=[],f=0,g=c.length-1;f<d;f++)e.push(c.charAt(Math.round(Math.random()*g)));return e.join("")},b=function(b){return"_"+a(b)},c=function(a){return parseInt(Math.random().toString().substr(2,a||10))},d={randomString:a,randomId:b,randomNumber:c};return this.publicateAPI("random",d)}),Modules.load("random").module("utils",function(a){var b=window,c={createGlobalCallback:function(c){for(var d=function(a){return b[a]=function(){c.call(b,arguments[0])},a},e=0;e++<10;){var f="_"+a.random.randomString();if("undefined"==typeof b[f])return d(f)}throw new Error("createGlobalCallback: cannot create unique name for callback")},removeGlobalCallback:function(a){try{b[a]=void 0,delete b[a]}catch(a){}},plural:function(a,b,c){var d=[2,0,1,1,1,2];return(c?a+" ":"")+b[a%100>4&&a%100<20?2:d[a%10<5?a%10:5]]}};return this.publicateAPI("utils",c)});