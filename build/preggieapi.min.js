/*! PREGGIE_JSAPI | 2016-02-22 */
(Modules=window.Modules||{}).name=Modules.name||"Modules";
Modules&&Modules.load||(Modules=window[Modules.name]=function(d){var b={},a={},c={},e=[],f={},g={},h={forced_loading:!1},l=function(){window.console&&console.warn.apply(console,arguments)},k=function(b){var a=b||[],c=function(b){for(var c=0;c<a.length;c++)b(a[c],c,a);return a};return{forEach:function(b){return c(function(){b.apply(a,arguments)})},map:function(b){var e=[];c(function(){e.push(b.apply(a,arguments))});return e},filter:function(b){var e=[];c(function(){b.apply(a,arguments)&&e.push(arguments[0])});
return e}}},n=function(b,a){e.push([b,a]);m()},m=function(){var a=[];e=k(e).filter(function(c){return 0<k(c[1]).filter(function(a){return!b[a]}).length||function(){a.push(function(a,b){return function(){a(b)}}(c[0],r(c[1])))}()});k(a).forEach(function(a){a()})},r=function(a){var c={};k(a).forEach(function(a){var e=c,d=a.split("."),q=d.pop();k(d).forEach(function(a){e=e[a]||(e[a]={})});e[q]=b[a]});return c},s=function(a){return{run:function(b){n(function(a){b.call(window[d],a)},a)},module:function(c,
e){g[c]||(g[c]=a);a.forEach(function(a){g[a]&&-1!=g[a].indexOf(c)&&l('Cross modular relation between modules "%s" and "%s". Modules not loaded.',c,a)});n(function(a){b[c]||(b[c]=e.call(window[d],a||void 0));m()},a)}}},p=function(a){for(var c=document.getElementsByTagName("script"),b=0;b<c.length;b++){var e=c[b].getAttribute("src")||"";if(-1!=e.indexOf(a))return e.substr(0,e.indexOf(a))}return""},t=function(b){for(var e in c)if(0==b.indexOf(e))return c[e];return function(){for(var c=b.length+1;0<--c;){var e=
b.substring(0,c);if("undefined"!=typeof a[e])return a[e]+"/"+b.substr(e.length).split(".").join("/")+".js"}return p("/modules.")+"/plugins/"+b.split(".").join("/")+".js"}().replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/\/-/g,"/")},u=function(){return function(a){if(!f[a]||h.forced_loading){var b=document.createElement("script");b.setAttribute("src",a+(h.forced_loading?"?"+Math.random():""));b.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(b);
f[a]=!0}else m()}}(),v=function(a){var c=function(a){var b=a.match(/^(.*)\((.*)\)$/)||[];return 3==b.length?k(b[2].split("|")).map(function(a){return b[1]+a}):[a]},e=[];k(a).forEach(function(a){k(c(a)).forEach(function(a){e.push(a);b[a]||u(t(a))})});return e};a["modules."]=p("/modules.")+"/plugins";return{load:function(){return s(v(Array.prototype.slice.call(arguments)))},addPath:function(b,c){a[b]=c},addPackage:function(a,b){c[a]=b},publicateAPI:function(a,b){"undefined"==typeof window[d][a]&&(window[d][a]=
b);return b},self:function(a){f[a]=!0},module:function(a,c){b[a]||(b[a]=c.call(window[d],void 0));m()},setup:function(a){for(var b in a)h[b]=a[b];return this},name:window[d].name,$debugger:{modules:b,paths:a,packages:c,hooks:e,dependencies:g}}}("Modules"));
PREGGIEAPI.load("device","utils","random").module("api",function(d){var b=function(){};b.prototype.deviceInterface=function(){return this};b.prototype.getCurrentUserId=function(){return"12345"};b.prototype.showToast=function(a){alert(a)};b.prototype.getAuthToken=function(a){a=JSON.parse(a);fetch("http://extension-consultation.preggie.testbb.ru/auth/ext",{method:"POST",body:JSON.stringify({username:"admin",password:"1"}),headers:{"Content-Type":"application/json"}}).then(function(a){return a.json()}).then(function(b){window[a.success]({token:"JWT "+
b.token})})["catch"](function(){window[a.error]({status:101,statusText:"getAuthToken error"})})};b.prototype.upload=function(a,b){b=JSON.parse(b);var d=0;Math.random();var g=setInterval(function(){window[b.progress]({progress:d+=10});100==d&&(clearInterval(g),window[b.success]({name:"2015:12:23:0820a982-8837-4f26-b8e0-cea32c121c6c.jpg"}))},500);window[b.preview]("iVBORw0KGgoAAAANSUhEUgAAADEAAAA0CAIAAACsM0f4AAADPklEQVR42u2X30tTYRjHj+gMttqPznYwu9CbKUxCyh9sI6YLERkuJdRQKoKg/gDvu+jeP6Cgq0ohJLULiVkXDpRASwbbErdgY8yBUslsQzfDHjzx8uz17OxsHLcZ52EX73nPe57z2fN+n+d9Ts3x8TFTZVajMClMCpPCpDCdb6ZU6ncsFhFZYTSaWJYTvJXNZnZ3E3t7P/hLvZ41ma6oVPX5XMF6shhMo7moVl8SYNrc9E9NPRVhcrvH3O671GQ6vR8IbESjIWq+p8cFWPlcra158SMWy3WL5YY8TNvb0aWl9xqN+vRiESb4G4uLb/GMbEzJ5M+5uTeCQOJMVJCKYDIYTFqtDq9wOgfsdie5nJ9/fXR0SC61WkNLyzVQBoxBmhzXICgRUNLCwitqUirT5OSz1ta2fDGDXVtd/UguOzsdzc1mRoIFg1+DwY0zYfJ6P+zsxMU9CgZpevo5v92pVJrsuzxMs7Mv+QG4nph4IpL2+YJkNreFQgHZmKAULS8v8mOOu+pwDBQbJHhKp9PLyQS+fL7P2B3IKxz+dnCQNhiMICzBjItEQuvrXn5st/f5/V+SyV/FMdlsvUZjTtWGpOPrON4C8B6PR6nchn1pb7dSL5iZeaFS1Z4E7M/4+GOP513RTKeNRA4LHMsi9w/0NTY2CQaJT1KZmbC7fFZXd2F4+F6+IFFO5GcCwdpst7LZQ49nAVdRl2uML5u4mMGeQmhLZBLRE8Uk+G68fWQ9LhylMInkHXYHR0p//x1yi9Qt8iZcOPC7K8mEEwJEplb/q92JRJzUcRAZyxphgF0Vx4QP9oJMUhKC2MjIoxKZcH2i8qtiTFgiYEND93nZUs0a30KViYnqgUh6w4GD6ydhFTR56hPuM6leEZgymQyeaWoyd3U5RLzJz3S6p8YGdWh09KFgn3mGTEzuEUYZddiVj4k5EfvKyieqK7dae7Xay0whk8RU8ncw7CN8FDAnn5oSG06JVpXf5grT/8EUi30Ph3M62o6Om1Ky6QyZtrZ88MO3bbZ+lm2oPFNtbX13dy8/A0GSN89LZNJo9E7n7TJznEMmOEo5rpGfqQhcAY0PDj6oCias8fInHXNu9KQwCdhfKV/ntwyR1acAAAAASUVORK5CYII=");
return g};b.prototype.cancelUpload=function(a){clearInterval(a)};b.prototype.makePayment=function(a,b){b=JSON.parse(b);setTimeout(function(){window[b.success]({transaction_id:d.random.randomNumber(),additionalDate:{}})},1E3)};b.prototype.getAppId=function(){return"12345"};b.prototype.canExit=function(a){};var a=function(){this.deviceInterface=function(){return d.device.os.android()?window.Android:d.device.os.ios()?window.iOS:(new b).deviceInterface()};Object.defineProperties(this,{_token:{writable:!0,
value:null},_canExit:{writable:!0,value:!0}})};a.prototype=Object.create(b.prototype);a.prototype.constructor=a;a.prototype.getCurrentUserId=function(){return this.deviceInterface().getCurrentUserId()};a.prototype.showToast=function(a){this.deviceInterface().showToast(a)};a.prototype.getAuthToken=function(a){if(!a)return this._token;var b=this,f=d.utils.createGlobalCallback(function(h){[f,g].forEach(function(a){d.utils.removeGlobalCallback(a)});a.success&&a.success(b._token=h.token,h)}),g=d.utils.createGlobalCallback(function(b){[f,
g].forEach(function(a){d.utils.removeGlobalCallback(a)});a.error&&a.error(b)});return this.deviceInterface().getAuthToken(JSON.stringify({success:f,error:g}))};a.prototype.upload=function(a,b){var f=d.utils.createGlobalCallback(b.preview),g=d.utils.createGlobalCallback(b.progress),h=d.utils.createGlobalCallback(function(a){[f,g,h,l].forEach(function(a){d.utils.removeGlobalCallback(a)});b.success&&b.success(a)}),l=d.utils.createGlobalCallback(function(a){[f,g,h,l].forEach(function(a){d.utils.removeGlobalCallback(a)});
b.error&&b.error(a)});return this.deviceInterface().upload(a,JSON.stringify({preview:f,progress:g,success:h,error:l}))};a.prototype.cancelUpload=function(a){this.deviceInterface().cancelUpload(a)};a.prototype.makePayment=function(a,b){var f=d.utils.createGlobalCallback(function(a){[f,g].forEach(function(a){d.utils.removeGlobalCallback(a)});b.success&&b.success(a)}),g=d.utils.createGlobalCallback(function(a){[f,g].forEach(function(a){d.utils.removeGlobalCallback(a)});b.error&&b.error(a)});this.deviceInterface().makePayment(a,
JSON.stringify({success:f,error:g}))};a.prototype.getAppId=function(){return this.deviceInterface().getAppId()};a.prototype.canExit=function(a){0<arguments.length&&(this._canExit=!!a);this.deviceInterface().canExit(this._canExit);return this._canExit};return this.publicateAPI("API",new a)});
PREGGIEAPI.module("date",function(){var d={absolute:function(){var b=new Date(0);return{day:function(a){return b.setDate(a),this},month:function(a){return b.setMonth(a-1),this},year:function(a){return b.setFullYear(a),this},getTime:function(){return b.getTime()},getUTC:function(){return b.toUTCString()}}},unixtime:function(b){return~~((b||new Date).getTime()/1E3)},toLocaleString:function(b,a,c){return(new Date(1E3*(b||d.unixtime()))).toLocaleString(a||"ru",c)},H_M:function(b){var a=new Date(1E3*b);
b=10>a.getHours()?"0"+a.getHours():a.getHours();a=10>a.getMinutes()?"0"+a.getMinutes():a.getMinutes();return b+":"+a}};return this.publicateAPI("date",d)});
PREGGIEAPI.module("device",function(d){d=navigator.userAgent;var b=null;d.match(/Web[kK]it[\/]{0,1}([\d.]+)/);var a=d.match(/(Android);?[\s\/]+([\d.]+)?/),c=d.match(/(iPad).*OS\s([\d_]+)/),e=d.match(/(iPod)(.*OS\s([\d_]+))?/),f=!c&&d.match(/(iPhone\sOS)\s([\d_]+)/);d={platform:{name:(navigator.platform.match(/mac|win|linux/i)||["unknown"])[0].toLowerCase()},webview:function(){return"undefined"!=typeof window.Android||"undefined"!=typeof window.iOS},os:{version:function(){return b},android:function(){a&&
(b=a[2]);return a},ios:function(){return this.ipad()||this.ipod()||this.iphone()},ipad:function(){c&&(b=c[2].replace(/_/g,"."));return c},ipod:function(){e&&(b=e[3]?e[3].replace(/_/g,"."):null);return e},iphone:function(){f&&!e&&(b=f[2].replace(/_/g,"."));return f}}};return this.publicateAPI("device",d)});
PREGGIEAPI.module("random",function(){var d=function(b,a){for(var c=a||"ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz_0123456789",d=b||16,f=[],g=0,h=c.length-1;g<d;g++)f.push(c.charAt(Math.round(Math.random()*h)));return f.join("")};return this.publicateAPI("random",{randomString:d,randomId:function(b){return"_"+d(b)},randomNumber:function(b){return parseInt(Math.random().toString().substr(2,b||10))}})});
PREGGIEAPI.load("random").module("utils",function(d){var b=window;return this.publicateAPI("utils",{createGlobalCallback:function(a,c,e){c=function(c){b[c]=function(c){a.call(b,c)};return c};for(e=0;10>e++;){var f="_"+d.random.randomString();if("undefined"==typeof b[f])return c(f)}throw Error("createGlobalCallback: cannot create unique name for callback");},removeGlobalCallback:function(a){try{b[a]=void 0,delete b[a]}catch(c){}},plural:function(a,b,d){var f=[2,0,1,1,1,2];return(d?a+" ":"")+b[4<a%
100&&20>a%100?2:f[5>a%10?a%10:5]]}})});
